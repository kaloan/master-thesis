\section{\hspace{1em}Задача за здравна политика}
\begin{frame}{Задача за здравна политика}
  Питаме се има ли такива управления $\boldsymbol{u}$, за които във всеки момент всички заразени да имат възможност да получат помощ от здравната система, т.е. :
  \begin{equation}
    \label{eq:AllHospitalised}
    \forall t \geq 0 (x_1(t) \leq \bar{I}_1 \wedge x_2(t) \leq \bar{I}_2) \iff \forall t \geq 0 (\boldsymbol{z}(t) \in \mathscr{I})
  \end{equation}
  Тъй като първоначалният брой заразени хора и комари влияят на развитието на системата ще търсим \textbf{ядрото на слаба инвариантност на Белман}:
  \begin{equation}
    \label{eq:ViabilityKernel}
    V(\bar{\boldsymbol{I}}, \bar{\boldsymbol{u}}) = \{\boldsymbol{z}_0  \text{ начално условие} \vert \exists \boldsymbol{u} (\eqref{eq:AllHospitalised} \text{ е изпълнено})\}
  \end{equation}
  $\pmb{0}$ е равновесна за \eqref{eq:TheDimensionlessProblem} - за нея винаги е изпълнено \eqref{eq:AllHospitalised}, т.е.
  $\pmb{0} \in V(\bar{\boldsymbol{I}}, \bar{\boldsymbol{u}})$.
  Ако $\boldsymbol{z}_0 \notin \mathscr{I}$, то \eqref{eq:AllHospitalised} не е изпълнено и съответно $\boldsymbol{z}_0 \notin V(\bar{\boldsymbol{I}}, \bar{\boldsymbol{u}})$, т.е. $V(\bar{\boldsymbol{I}}, \bar{\boldsymbol{u}}) \subseteq \mathscr{I}$.
\end{frame}

\begin{frame}[t]{Тривиални случаи за $V(\bar{\boldsymbol{I}}, \bar{\boldsymbol{u}})$}
  \begin{proposition}
    Ако съществува $\boldsymbol{E}^* = (x_1^*, x_2^*, y_1^*, y_2^*)^T$ за $\boldsymbol{u}(t) \equiv \bar{\boldsymbol{u}}$, като $x_1^* > \bar{I}_1$ или $x_2^* > \bar{I}_2$, то ядрото на слаба инвариантност на Белман е тривиалното, т.е. $V(\bar{\boldsymbol{I}}, \bar{\boldsymbol{u}}) = \{\pmb{0}\}$.
  \end{proposition}

  Доказва се с кооперативността и непрекъснатостта на решението на \eqref{eq:TheDimensionlessProblem}.

  \begin{proposition}
    Ако \eqref{eq:AllHospitalised} е изпълнено за решението на система \eqref{eq:TheDimensionlessProblem} с $\boldsymbol{u} \equiv \pmb{0}$ и начално условие $\boldsymbol{z}_0 = (\xi_1, \xi_2, 1, 1)^T$, то $\Xi = [0, \xi_1] \times [0, \xi_2] \times [0, 1]^2 \subseteq V(\bar{\boldsymbol{I}}, \bar{\boldsymbol{u}})$.
    Ако е изпълнено за $\xi_i = \bar{I}_i$, то ядрото на слаба инвариантност на Белман е максималното, т.е. $V(\bar{\boldsymbol{I}}, \bar{\boldsymbol{u}}) = \mathscr{I}$.
  \end{proposition}

  Доказва се с кооперативността на \eqref{eq:TheDimensionlessProblem}.
\end{frame}

\begin{frame}[t]{Преформулировка на \eqref{eq:ViabilityKernel} като вариационна задача}
  Дефинираме значна фунцкия на разстоянието $\Gamma$ до $\partial \mathscr{I}$:
  \begin{equation}
    \Gamma(\boldsymbol{z}) =
    \begin{cases}
      \inf_{\boldsymbol{z}' \in \mathscr{I}} |\boldsymbol{z}-\boldsymbol{z}'|, \quad \boldsymbol{z} \in \Omega \setminus \mathscr{I} \\
      -\inf_{\boldsymbol{z}' \in \Omega \setminus \mathscr{I}} |\boldsymbol{z}-\boldsymbol{z}'|, \quad \boldsymbol{z} \in \mathscr{I}
    \end{cases}
  \end{equation}

  Фиксираме $\lambda>L>0$ ($L$ - константата на Липшиц за \eqref{eq:TheDimensionlessProblem}) и въвеждаме функция на Белман $v$:
  \begin{equation}
    v(\boldsymbol{z}_0) = \inf_{\boldsymbol{u} \in \mathscr{U}} \sup_{t \in (0, +\infty)} e^{-\lambda t} \Gamma(\boldsymbol{z}(t; \boldsymbol{z}_0; u))
  \end{equation}

  Ако започнем с $\boldsymbol{z}_0 \notin V(\bar{\boldsymbol{I}}, \bar{\boldsymbol{u}})$, то $v(\boldsymbol{z}_0) > 0$ и обратното.

  Ако започнем с $\boldsymbol{z}_0 \in V(\bar{\boldsymbol{I}}, \bar{\boldsymbol{u}})$, то $v(\boldsymbol{z}_0) \leq 0$ и обратното.
  \begin{equation*}
    V(\bar{\boldsymbol{I}}, \bar{\boldsymbol{u}}) = \{\boldsymbol{z}_0 \in \Omega \vert v(\boldsymbol{z}_0) \leq 0\}, \quad \partial V(\bar{\boldsymbol{I}}, \bar{\boldsymbol{u}}) = \{\boldsymbol{z}_0 \in \Omega \vert v(\boldsymbol{z}_0) = 0\}
  \end{equation*}
\end{frame}

\begin{frame}[t]{Уравнение на Хамилтон-Якоби-Белман}
  В сила е принцип за динамично програмиране:
  \begin{equation}
    v(\boldsymbol{z}_0) = \inf_{\boldsymbol{u} \in \mathscr{U}} \max\{e^{-\lambda t} v(\boldsymbol{z}_0), \sup_{s \in (0, t]} e^{-\lambda t} \Gamma(\boldsymbol{z}(s; \boldsymbol{z}_0; u))\}
  \end{equation}
  Може да се покаже, че $v$ е вискозното решение на \textbf{уравнението на Хамилтон-Якоби–Белман}:
  \begin{equation}
    \begin{split}
      \label{HJB}
      &\min\{\lambda v(\boldsymbol{z}) + \mathcal{H}(\boldsymbol{z}, \grad{v}), v(\boldsymbol{z}) - \Gamma(\boldsymbol{z}) \} = 0, \quad \boldsymbol{z} \in \mathbb{R}^4 \\
      &\mathcal{H}(\boldsymbol{z}, \boldsymbol{w}) = \max_{\boldsymbol{u} \in U} \innerproduct{-\boldsymbol{f}(\boldsymbol{z}, \boldsymbol{u})}{\boldsymbol{w}}
    \end{split}
  \end{equation}

  \begin{footnotesize}
    \begin{multline}
      \label{eq:HamiltonianShort}
      \mathcal{H}(\boldsymbol{z}, \grad{v}) = \\
      \left[\gamma_1 x_1 - (1-x_1) \left(b_{11} y_1 + b_{12} y_2\right) \right] \pdv{v}{x_1} +
      \left[\gamma_2 x_2 - (1-x_2) \left(b_{21} y_1 + b_{22} y_2\right) \right] \pdv{v}{x_2} + \\
      \left[\mu_1 y_1 - (1-y_1) \left(c_{11} x_1 + c_{12} x_2\right) \right] \pdv{v}{y_1} +
      \left[\mu_2 y_2 - (1-y_2) \left(c_{21} x_1 + c_{22} x_2\right)\right] \pdv{v}{y_2} + \\
      \max\bigg\{0, \kappa \bar{u}_1 (1-x_1) \left(b_{11} y_1 + b_{12} y_2\right) \pdv{v}{x_1} + c_{11} \kappa \bar{u}_1 x_1 (1-y_1)\pdv{v}{y_1} + c_{21} \bar{u}_1 x_1 (1-y_2) \pdv{v}{y_2}
      \bigg\} + \\
      \max\bigg\{0, \kappa \bar{u}_2 (1-x_2) \left(b_{21} y_1 + b_{22} y_2\right) \pdv{v}{x_2} + c_{12} \bar{u}_2 x_2 (1-y_1)\pdv{v}{y_1} + c_{22}  \bar{u}_2 x_2 (1-y_2)\pdv{v}{y_2} \bigg\}
    \end{multline}
  \end{footnotesize}

\end{frame}

\begin{frame}[t]{Числено решение на уравнението на Х-Я-Б}
  \vspace{-1em}
  Диференциалното уравнение се разглежда като стационарно решение на диференцална задача с добавено числено време само в околност на $\mathscr{I}$.
  Началното условие взимаме $v_0 = \Gamma$.

  Чрез WENO (Weighted Essentially Non-Oscillatory) метода се получават по-точни приближения за разлика напред и назад $v_{\eta}^{\pm}$ на производните $\pdv{v}{\eta},~ \eta = x_1, x_2, y_1, y_2$.

  Численият Хамилтонян от вида Lax-Friedrichs $\hat{\mathcal{H}}$ е:
  \begin{small}
    \begin{multline}
      \hat{\mathcal{H}} = \mathcal{H}\left(\boldsymbol{z}, \frac{v_{x_1}^++v_{x_1}^-}{2}, \frac{v_{x_2}^++v_{x_2}^-}{2}, \frac{v_{y_1}^++v_{y_1}^-}{2}, \frac{v_{y_2}^++v_{y_2}^-}{2}\right) \\ - \sum_{\eta = x_1, x_2, y_1, y_2} \alpha^{\eta} \frac{v_{\eta}^+-v_{\eta}^-}{2}
    \end{multline}
  \end{small}
  Множителите $\alpha^{\eta}$ са от вида:
  \begin{small}
    \begin{equation}
      \begin{split}
        &\alpha^{x_1} = \max \abs{\pdv{\mathcal{H}}{w_1}\left(\boldsymbol{z}, \boldsymbol{w}\right)},~
        \alpha^{x_2} = \max \abs{\pdv{\mathcal{H}}{w_2}\left(\boldsymbol{z}, \boldsymbol{w}\right)}, \\
        &\alpha^{y_1} = \max \abs{\pdv{\mathcal{H}}{w_3}\left(\boldsymbol{z}, \boldsymbol{w}\right)},~
        \alpha^{y_2} = \max \abs{\pdv{\mathcal{H}}{w_4}\left(\boldsymbol{z}, \boldsymbol{w}\right)}
      \end{split}
    \end{equation}
  \end{small}
\end{frame}

\begin{frame}[t]{Числено решение на уравнението на Х-Я-Б}
  Използваната дискретизацията по пространството е равномерна със стъпки $h_\eta,~ \eta = x_1, x_2, y_1, y_2$.

  Използваната дискретизация по времето е равномерна със стъпка $\tau$ и по него се апроксимира с подобрения метод на Ойлер.

  За да може методът да е TVD трябва да е изпълнено условието на Courant-Friedrichs-Lewy:
  \begin{equation}
    \tau \max \left(\frac{\abs{\pdv{\mathcal{H}}{w_1}}}{h_{x_1}} + \frac{\abs{\pdv{\mathcal{H}}{w_2}}}{h_{x_2}} + \frac{\abs{\pdv{\mathcal{H}}{w_3}}}{h_{y_1}} + \frac{\abs{\pdv{\mathcal{H}}{w_4}}}{h_{y_2}}\right) < 1
  \end{equation}
\end{frame}
